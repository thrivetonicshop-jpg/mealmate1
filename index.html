<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MealMate Onboarding Preview</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Fraunces:wght@600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html {
      height: 100%;
    }
    
    body {
      height: 100%;
      overflow-x: hidden;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    .onboarding-container {
      font-family: 'DM Sans', -apple-system, sans-serif;
      min-height: 100vh;
      min-height: 100dvh;
      background: linear-gradient(165deg, #fef9f3 0%, #fff8ed 50%, #fef3e3 100%);
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .onboarding-container::before {
      content: '';
      position: absolute;
      top: -20%;
      right: -30%;
      width: 60vw;
      height: 60vw;
      background: radial-gradient(circle, rgba(255, 183, 77, 0.15) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    .onboarding-container::after {
      content: '';
      position: absolute;
      bottom: -10%;
      left: -20%;
      width: 50vw;
      height: 50vw;
      background: radial-gradient(circle, rgba(76, 175, 80, 0.1) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    .progress-container {
      padding: 16px 24px;
      display: flex;
      justify-content: center;
      gap: 10px;
      z-index: 10;
      position: relative;
    }

    .progress-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #e0d5c8;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .progress-dot.active {
      background: #ff7043;
      width: 28px;
      border-radius: 5px;
    }

    .progress-dot.completed {
      background: #4caf50;
    }

    .skip-btn {
      position: absolute;
      top: 16px;
      right: 20px;
      background: none;
      border: none;
      color: #8b7355;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      padding: 8px 12px;
      z-index: 100;
      transition: color 0.2s;
      touch-action: manipulation;
    }

    .skip-btn:hover,
    .skip-btn:active {
      color: #5d4e37;
    }

    .step-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px 24px;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      position: relative;
      z-index: 5;
    }

    .step-content {
      animation: slideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .step-content.hidden {
      display: none;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInReverse {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .step-content.reverse {
      animation: slideInReverse 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .step-title {
      font-family: 'Fraunces', Georgia, serif;
      font-size: clamp(28px, 7vw, 36px);
      font-weight: 700;
      color: #2d2013;
      line-height: 1.2;
      margin-bottom: 12px;
    }

    .step-subtitle {
      font-size: 17px;
      color: #6b5a47;
      line-height: 1.5;
      margin-bottom: 32px;
    }

    .welcome-icon {
      width: 120px;
      height: 120px;
      margin: 0 auto 32px;
      background: linear-gradient(135deg, #ff7043 0%, #ff8a65 100%);
      border-radius: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 56px;
      box-shadow: 0 12px 40px rgba(255, 112, 67, 0.3);
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    .welcome-features {
      margin-top: 40px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .feature-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.7);
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }

    .feature-icon {
      width: 44px;
      height: 44px;
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      flex-shrink: 0;
    }

    .feature-text {
      font-size: 15px;
      color: #3d3225;
      font-weight: 500;
    }

    .options-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .option-card {
      background: rgba(255, 255, 255, 0.8);
      border: 2px solid transparent;
      border-radius: 20px;
      padding: 20px 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      user-select: none;
    }

    .option-card:hover,
    .option-card:active {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    }

    .option-card.selected {
      background: linear-gradient(135deg, #fff8ed 0%, #ffecb3 100%);
      border-color: #ff7043;
      box-shadow: 0 4px 20px rgba(255, 112, 67, 0.2);
    }

    .option-icon {
      font-size: 32px;
      line-height: 1;
      pointer-events: none;
    }

    .option-label {
      font-size: 14px;
      font-weight: 600;
      color: #3d3225;
      text-align: center;
      pointer-events: none;
    }

    .option-card.selected .option-label {
      color: #c62828;
    }

    .options-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .option-row {
      background: rgba(255, 255, 255, 0.8);
      border: 2px solid transparent;
      border-radius: 16px;
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      user-select: none;
    }

    .option-row:hover,
    .option-row:active {
      background: rgba(255, 255, 255, 0.95);
    }

    .option-row.selected {
      background: linear-gradient(135deg, #fff8ed 0%, #ffecb3 100%);
      border-color: #ff7043;
    }

    .option-row .option-icon {
      font-size: 28px;
      pointer-events: none;
    }

    .option-row .option-label {
      font-size: 16px;
      text-align: left;
      pointer-events: none;
    }

    .option-check {
      margin-left: auto;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid #ccc;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
      font-size: 14px;
      pointer-events: none;
    }

    .option-row.selected .option-check {
      background: #4caf50;
      border-color: #4caf50;
      color: white;
    }

    .size-picker {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin: 20px 0;
      flex-wrap: wrap;
    }

    .size-btn {
      width: 72px;
      height: 72px;
      border-radius: 50%;
      border: 3px solid #e0d5c8;
      background: rgba(255, 255, 255, 0.8);
      font-size: 24px;
      font-weight: 700;
      color: #5d4e37;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      align-items: center;
      justify-content: center;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      font-family: 'DM Sans', sans-serif;
      user-select: none;
    }

    .size-btn:hover,
    .size-btn:active {
      transform: scale(1.05);
      border-color: #ff7043;
    }

    .size-btn.selected {
      background: linear-gradient(135deg, #ff7043 0%, #ff8a65 100%);
      border-color: #ff7043;
      color: white;
      box-shadow: 0 6px 24px rgba(255, 112, 67, 0.35);
    }

    .level-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    .level-card {
      background: rgba(255, 255, 255, 0.8);
      border: 2px solid transparent;
      border-radius: 16px;
      padding: 18px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      cursor: pointer;
      transition: all 0.3s;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      user-select: none;
    }

    .level-card:hover,
    .level-card:active {
      background: rgba(255, 255, 255, 0.95);
    }

    .level-card.selected {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border-color: #4caf50;
    }

    .level-emoji {
      font-size: 32px;
      pointer-events: none;
    }

    .level-info {
      flex: 1;
      pointer-events: none;
    }

    .level-name {
      font-size: 16px;
      font-weight: 600;
      color: #2d2013;
    }

    .level-desc {
      font-size: 13px;
      color: #6b5a47;
      margin-top: 2px;
    }

    .final-icon {
      width: 140px;
      height: 140px;
      margin: 0 auto 28px;
      background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 64px;
      box-shadow: 0 16px 48px rgba(76, 175, 80, 0.3);
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .personalization-preview {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 20px;
      padding: 20px;
      margin-top: 24px;
      backdrop-filter: blur(10px);
    }

    .preview-title {
      font-size: 14px;
      font-weight: 600;
      color: #8b7355;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .preview-items {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .preview-tag {
      background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      color: #e65100;
      text-transform: capitalize;
    }

    .nav-container {
      padding: 20px 24px 32px;
      display: flex;
      gap: 12px;
      z-index: 10;
      position: relative;
    }

    .nav-btn {
      flex: 1;
      padding: 18px 24px;
      border-radius: 16px;
      font-size: 17px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      font-family: 'DM Sans', sans-serif;
      user-select: none;
    }

    .nav-btn.secondary {
      background: rgba(255, 255, 255, 0.8);
      color: #5d4e37;
      flex: 0.4;
    }

    .nav-btn.secondary:hover,
    .nav-btn.secondary:active {
      background: rgba(255, 255, 255, 0.95);
    }

    .nav-btn.primary {
      background: linear-gradient(135deg, #ff7043 0%, #ff5722 100%);
      color: white;
      box-shadow: 0 6px 24px rgba(255, 112, 67, 0.35);
    }

    .nav-btn.primary:hover,
    .nav-btn.primary:active {
      transform: translateY(-2px);
      box-shadow: 0 8px 32px rgba(255, 112, 67, 0.4);
    }

    .nav-btn.primary:disabled {
      background: #ccc;
      box-shadow: none;
      cursor: not-allowed;
      transform: none;
    }

    .nav-btn.primary.full {
      flex: 1;
    }

    .nav-btn.cta {
      background: linear-gradient(135deg, #4caf50 0%, #43a047 100%);
      box-shadow: 0 6px 24px rgba(76, 175, 80, 0.35);
    }

    .nav-btn.cta:hover,
    .nav-btn.cta:active {
      box-shadow: 0 8px 32px rgba(76, 175, 80, 0.4);
    }

    /* Success Modal */
    .success-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .success-modal.show {
      display: flex;
    }

    .success-content {
      background: white;
      border-radius: 24px;
      padding: 32px;
      text-align: center;
      max-width: 340px;
    }

    .success-content h2 {
      font-family: 'Fraunces', serif;
      font-size: 24px;
      color: #2d2013;
      margin-bottom: 12px;
    }

    .success-content p {
      color: #6b5a47;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .success-content pre {
      background: #f5f5f5;
      border-radius: 12px;
      padding: 16px;
      text-align: left;
      font-size: 11px;
      overflow-x: auto;
      margin-top: 16px;
    }

    @media (max-width: 380px) {
      .options-grid {
        grid-template-columns: 1fr;
      }
      
      .size-btn {
        width: 64px;
        height: 64px;
        font-size: 20px;
      }
    }

    @media (min-width: 500px) {
      .step-container {
        max-width: 440px;
        margin: 0 auto;
      }
    }
  </style>
</head>
<body>
  <div class="onboarding-container">
    <button class="skip-btn" id="skipBtn" style="display: none;">Skip</button>
    
    <div class="progress-container" id="progressDots"></div>
    
    <div class="step-container">
      <!-- Step 0: Welcome -->
      <div class="step-content" id="step0">
        <div class="welcome-icon">üçΩÔ∏è</div>
        <h1 class="step-title" style="text-align: center;">Welcome to MealMate</h1>
        <p class="step-subtitle" style="text-align: center;">Your AI-powered kitchen companion. Let's set up your personalized meal planning experience.</p>
        <div class="welcome-features">
          <div class="feature-item">
            <div class="feature-icon">üß†</div>
            <span class="feature-text">AI chef creates meals from what's in your fridge</span>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üìÖ</div>
            <span class="feature-text">Weekly meal plans tailored to your goals</span>
          </div>
          <div class="feature-item">
            <div class="feature-icon">üõí</div>
            <span class="feature-text">Smart grocery lists with zero waste</span>
          </div>
        </div>
      </div>

      <!-- Step 1: Goals -->
      <div class="step-content hidden" id="step1">
        <h1 class="step-title">What are your goals?</h1>
        <p class="step-subtitle">Select all that apply. We'll personalize your experience.</p>
        <div class="options-grid" id="goalsGrid"></div>
      </div>

      <!-- Step 2: Dietary -->
      <div class="step-content hidden" id="step2">
        <h1 class="step-title">Any dietary needs?</h1>
        <p class="step-subtitle">Select any restrictions or preferences. Skip if none.</p>
        <div class="options-list" id="dietaryList"></div>
      </div>

      <!-- Step 3: Household -->
      <div class="step-content hidden" id="step3">
        <h1 class="step-title">Who's eating?</h1>
        <p class="step-subtitle">How many people are you cooking for?</p>
        <div class="size-picker" id="sizePicker"></div>
        <p class="step-subtitle" style="margin-top: 32px; margin-bottom: 16px;">Your cooking comfort level?</p>
        <div class="level-options" id="levelOptions"></div>
      </div>

      <!-- Step 4: Final -->
      <div class="step-content hidden" id="step4">
        <div class="final-icon">‚ú®</div>
        <h1 class="step-title" style="text-align: center;">You're all set!</h1>
        <p class="step-subtitle" style="text-align: center;">MealMate will now create personalized meal plans just for you.</p>
        <div class="personalization-preview" id="previewContainer" style="display: none;">
          <div class="preview-title">Your Preferences</div>
          <div class="preview-items" id="previewItems"></div>
        </div>
      </div>
    </div>

    <div class="nav-container" id="navContainer"></div>
  </div>

  <!-- Success Modal -->
  <div class="success-modal" id="successModal">
    <div class="success-content">
      <h2>üéâ Onboarding Complete!</h2>
      <p>User data collected successfully:</p>
      <pre id="userData"></pre>
      <p style="margin-top: 16px; font-size: 12px; color: #999;">This data would be saved to Supabase</p>
    </div>
  </div>

  <script>
    // State
    let currentStep = 0;
    const totalSteps = 5;
    const userData = {
      goals: [],
      dietary: [],
      householdSize: null,
      cookingLevel: null
    };

    // Data
    const goals = [
      { id: 'save-time', icon: '‚è±Ô∏è', label: 'Save Time' },
      { id: 'eat-healthier', icon: 'ü•ó', label: 'Eat Healthier' },
      { id: 'save-money', icon: 'üí∞', label: 'Save Money' },
      { id: 'reduce-waste', icon: '‚ôªÔ∏è', label: 'Reduce Waste' },
      { id: 'learn-cooking', icon: 'üë®‚Äçüç≥', label: 'Learn to Cook' },
      { id: 'variety', icon: 'üåç', label: 'More Variety' }
    ];

    const dietary = [
      { id: 'vegetarian', icon: 'ü•¨', label: 'Vegetarian' },
      { id: 'vegan', icon: 'üå±', label: 'Vegan' },
      { id: 'gluten-free', icon: 'üåæ', label: 'Gluten-Free' },
      { id: 'dairy-free', icon: 'ü•õ', label: 'Dairy-Free' },
      { id: 'keto', icon: 'ü•ë', label: 'Keto / Low-Carb' },
      { id: 'halal', icon: 'üçñ', label: 'Halal' }
    ];

    const sizes = [1, 2, 3, 4, '5+'];

    const levels = [
      { id: 'beginner', emoji: 'üç≥', name: 'Beginner', desc: 'Simple recipes, basic techniques' },
      { id: 'intermediate', emoji: 'üë®‚Äçüç≥', name: 'Home Cook', desc: 'Comfortable in the kitchen' },
      { id: 'advanced', emoji: '‚≠ê', name: 'Adventurous', desc: 'Bring on the challenge!' }
    ];

    // Event delegation for touch/click handling
    function handleTap(selector, callback) {
      document.addEventListener('click', function(e) {
        const target = e.target.closest(selector);
        if (target) {
          e.preventDefault();
          callback(target);
        }
      }, { passive: false });
      
      // Also handle touchend for more responsive mobile
      document.addEventListener('touchend', function(e) {
        const target = e.target.closest(selector);
        if (target) {
          e.preventDefault();
          callback(target);
        }
      }, { passive: false });
    }

    // Initialize
    function init() {
      renderProgressDots();
      renderGoals();
      renderDietary();
      renderSizes();
      renderLevels();
      renderNav();
      updateView();
      setupEventListeners();
    }

    function setupEventListeners() {
      // Goal cards
      handleTap('.option-card[data-goal]', function(el) {
        toggleGoal(el.dataset.goal);
      });
      
      // Dietary rows
      handleTap('.option-row[data-dietary]', function(el) {
        toggleDietary(el.dataset.dietary);
      });
      
      // Size buttons
      handleTap('.size-btn[data-size]', function(el) {
        selectSize(el.dataset.size);
      });
      
      // Level cards
      handleTap('.level-card[data-level]', function(el) {
        selectLevel(el.dataset.level);
      });
      
      // Nav buttons
      handleTap('.nav-btn[data-action="next"]', function(el) {
        if (!el.disabled) nextStep();
      });
      
      handleTap('.nav-btn[data-action="prev"]', function(el) {
        prevStep();
      });
      
      handleTap('.nav-btn[data-action="complete"]', function(el) {
        complete();
      });
      
      // Skip button
      handleTap('#skipBtn', function() {
        currentStep = 4;
        updateView();
      });
      
      // Close modal
      handleTap('#successModal', function(el) {
        if (el.id === 'successModal') {
          el.classList.remove('show');
        }
      });
    }

    function renderProgressDots() {
      const container = document.getElementById('progressDots');
      container.innerHTML = '';
      for (let i = 0; i < totalSteps; i++) {
        const dot = document.createElement('div');
        dot.className = 'progress-dot';
        if (i === currentStep) dot.classList.add('active');
        if (i < currentStep) dot.classList.add('completed');
        container.appendChild(dot);
      }
    }

    function renderGoals() {
      const grid = document.getElementById('goalsGrid');
      grid.innerHTML = goals.map(g => `
        <div class="option-card ${userData.goals.includes(g.id) ? 'selected' : ''}" data-goal="${g.id}">
          <span class="option-icon">${g.icon}</span>
          <span class="option-label">${g.label}</span>
        </div>
      `).join('');
    }

    function renderDietary() {
      const list = document.getElementById('dietaryList');
      list.innerHTML = dietary.map(d => `
        <div class="option-row ${userData.dietary.includes(d.id) ? 'selected' : ''}" data-dietary="${d.id}">
          <span class="option-icon">${d.icon}</span>
          <span class="option-label">${d.label}</span>
          <div class="option-check">${userData.dietary.includes(d.id) ? '‚úì' : ''}</div>
        </div>
      `).join('');
    }

    function renderSizes() {
      const picker = document.getElementById('sizePicker');
      picker.innerHTML = sizes.map(s => `
        <button type="button" class="size-btn ${userData.householdSize === s || userData.householdSize === String(s) ? 'selected' : ''}" data-size="${s}">${s}</button>
      `).join('');
    }

    function renderLevels() {
      const options = document.getElementById('levelOptions');
      options.innerHTML = levels.map(l => `
        <div class="level-card ${userData.cookingLevel === l.id ? 'selected' : ''}" data-level="${l.id}">
          <span class="level-emoji">${l.emoji}</span>
          <div class="level-info">
            <div class="level-name">${l.name}</div>
            <div class="level-desc">${l.desc}</div>
          </div>
        </div>
      `).join('');
    }

    function renderNav() {
      const nav = document.getElementById('navContainer');
      
      if (currentStep === 0) {
        nav.innerHTML = '<button type="button" class="nav-btn primary full" data-action="next">Let\'s Go ‚Üí</button>';
      } else if (currentStep === 4) {
        nav.innerHTML = '<button type="button" class="nav-btn primary cta full" data-action="complete">Start Cooking üöÄ</button>';
      } else {
        const disabled = !canProceed() ? 'disabled' : '';
        nav.innerHTML = `
          <button type="button" class="nav-btn secondary" data-action="prev">Back</button>
          <button type="button" class="nav-btn primary" data-action="next" ${disabled}>Continue ‚Üí</button>
        `;
      }
    }

    function renderPreview() {
      const container = document.getElementById('previewContainer');
      const items = document.getElementById('previewItems');
      const allTags = [...userData.goals, ...userData.dietary];
      
      if (allTags.length > 0 || userData.householdSize) {
        container.style.display = 'block';
        let html = allTags.map(t => `<span class="preview-tag">${t.replace('-', ' ')}</span>`).join('');
        if (userData.householdSize) {
          const label = userData.householdSize === '5+' ? '5+ people' : 
                       (userData.householdSize === 1 || userData.householdSize === '1' ? '1 person' : `${userData.householdSize} people`);
          html += `<span class="preview-tag">${label}</span>`;
        }
        items.innerHTML = html;
      } else {
        container.style.display = 'none';
      }
    }

    function canProceed() {
      if (currentStep === 1) return userData.goals.length > 0;
      if (currentStep === 3) return userData.householdSize !== null;
      return true;
    }

    function updateView() {
      // Update progress dots
      renderProgressDots();
      
      // Show/hide skip button
      document.getElementById('skipBtn').style.display = 
        (currentStep > 0 && currentStep < 4) ? 'block' : 'none';
      
      // Show/hide steps
      for (let i = 0; i < totalSteps; i++) {
        const step = document.getElementById(`step${i}`);
        if (i === currentStep) {
          step.classList.remove('hidden');
          step.classList.add('step-content');
        } else {
          step.classList.add('hidden');
        }
      }
      
      // Update nav
      renderNav();
      
      // Update preview on final step
      if (currentStep === 4) {
        renderPreview();
      }
    }

    function nextStep() {
      if (currentStep < totalSteps - 1 && canProceed()) {
        currentStep++;
        updateView();
      }
    }

    function prevStep() {
      if (currentStep > 0) {
        currentStep--;
        updateView();
      }
    }

    function toggleGoal(id) {
      const idx = userData.goals.indexOf(id);
      if (idx > -1) {
        userData.goals.splice(idx, 1);
      } else {
        userData.goals.push(id);
      }
      renderGoals();
      renderNav();
    }

    function toggleDietary(id) {
      const idx = userData.dietary.indexOf(id);
      if (idx > -1) {
        userData.dietary.splice(idx, 1);
      } else {
        userData.dietary.push(id);
      }
      renderDietary();
    }

    function selectSize(size) {
      userData.householdSize = size === '5+' ? '5+' : parseInt(size);
      renderSizes();
      renderNav();
    }

    function selectLevel(id) {
      userData.cookingLevel = id;
      renderLevels();
    }

    function complete() {
      document.getElementById('userData').textContent = JSON.stringify(userData, null, 2);
      document.getElementById('successModal').classList.add('show');
      
      // This is where you'd save to Supabase:
      // await supabase.from('user_preferences').upsert({ user_id: userId, ...userData });
      console.log('Onboarding complete:', userData);
    }

    // Initialize on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
