<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>MealMate - AI Meal Planning</title>
  <meta name="description" content="AI-powered meal planning. Plan meals, generate grocery lists, track nutrition.">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3073911588578821" crossorigin="anonymous"></script>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçΩÔ∏è</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: { extend: { fontFamily: { sans: ['Outfit', 'sans-serif'] } } }
    }
  </script>
  <style>
    * { font-family: 'Outfit', sans-serif; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(16,185,129,0.4); } 50% { box-shadow: 0 0 40px rgba(16,185,129,0.8); } }
    .animate-float { animation: float 3s ease-in-out infinite; }
    .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
    .glass { background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); }
    .dark .glass { background: rgba(15,23,42,0.9); }
  </style>
</head>
<body class="bg-gradient-to-br from-emerald-50 via-white to-teal-50 dark:from-slate-950 dark:via-slate-900 dark:to-emerald-950 min-h-screen">
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, createContext, useContext } = React;

const SUPABASE_URL = 'https://svjixbhwtykvhmybycqt.supabase.co';
const SUPABASE_KEY = 'sb_publishable_9EFLAWNJW7EOBaz8KlY_UQ_S-cwwNOD';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

const AppContext = createContext();
const useApp = () => useContext(AppContext);

function AppProvider({ children }) {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);
  const [darkMode, setDarkMode] = useState(false);
  const [mealPlan, setMealPlan] = useState({});
  const [groceryList, setGroceryList] = useState([]);
  const [aiMessages, setAiMessages] = useState([]);
  const [aiLoading, setAiLoading] = useState(false);

  useEffect(() => {
    supabase.auth.getSession().then(({ data: { session } }) => {
      setUser(session?.user ?? null);
      setLoading(false);
    });
    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
      setUser(session?.user ?? null);
    });
    return () => subscription.unsubscribe();
  }, []);

  useEffect(() => {
    if (darkMode) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  }, [darkMode]);

  const signUp = async (email, password) => {
    const { error } = await supabase.auth.signUp({ email, password });
    return { error };
  };

  const signIn = async (email, password) => {
    const { error } = await supabase.auth.signInWithPassword({ email, password });
    return { error };
  };

  const signOut = async () => {
    await supabase.auth.signOut();
  };

  const askAI = async (message) => {
    setAiLoading(true);
    const newMessages = [...aiMessages, { role: 'user', content: message }];
    setAiMessages(newMessages);
    
    try {
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ messages: newMessages.map(m => ({ role: m.role, content: m.content })) })
      });
      const data = await res.json();
      if (data.content && data.content[0]) {
        setAiMessages([...newMessages, { role: 'assistant', content: data.content[0].text }]);
      }
    } catch (err) {
      setAiMessages([...newMessages, { role: 'assistant', content: 'Sorry, I had trouble connecting. Please try again.' }]);
    }
    setAiLoading(false);
  };

  const value = {
    user, loading, darkMode, setDarkMode,
    mealPlan, setMealPlan, groceryList, setGroceryList,
    aiMessages, aiLoading, askAI,
    signUp, signIn, signOut
  };

  return <AppContext.Provider value={value}>{children}</AppContext.Provider>;
}

function Card({ children, className = '' }) {
  return (
    <div className={`glass rounded-2xl p-6 shadow-lg border border-slate-200 dark:border-slate-700 ${className}`}>
      {children}
    </div>
  );
}

function LandingPage() {
  const { signIn, signUp } = useApp();
  const [isLogin, setIsLogin] = useState(true);
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setLoading(true);
    
    const { error } = isLogin 
      ? await signIn(email, password)
      : await signUp(email, password);
    
    if (error) {
      setError(error.message);
    }
    setLoading(false);
  };

  return (
    <div className="min-h-screen flex flex-col">
      <header className="glass sticky top-0 z-50 border-b border-slate-200 dark:border-slate-700">
        <div className="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center animate-float">
              <span className="text-xl">üçΩÔ∏è</span>
            </div>
            <span className="text-xl font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">MealMate</span>
          </div>
        </div>
      </header>

      <main className="flex-1 flex items-center justify-center p-4">
        <div className="w-full max-w-md">
          <Card>
            <div className="text-center mb-8">
              <div className="w-20 h-20 rounded-2xl bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center mx-auto mb-4 animate-pulse-glow">
                <span className="text-4xl">üçΩÔ∏è</span>
              </div>
              <h1 className="text-3xl font-bold text-slate-900 dark:text-white mb-2">Welcome to MealMate</h1>
              <p className="text-slate-600 dark:text-slate-400">AI-powered meal planning made simple</p>
            </div>

            <div className="flex mb-6 bg-slate-100 dark:bg-slate-800 rounded-xl p-1">
              <button
                onClick={() => setIsLogin(true)}
                className={`flex-1 py-2 rounded-lg font-medium transition-all ${isLogin ? 'bg-white dark:bg-slate-700 shadow text-emerald-600' : 'text-slate-600 dark:text-slate-400'}`}
              >
                Sign In
              </button>
              <button
                onClick={() => setIsLogin(false)}
                className={`flex-1 py-2 rounded-lg font-medium transition-all ${!isLogin ? 'bg-white dark:bg-slate-700 shadow text-emerald-600' : 'text-slate-600 dark:text-slate-400'}`}
              >
                Sign Up
              </button>
            </div>

            <form onSubmit={handleSubmit} className="space-y-4">
              <div>
                <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Email</label>
                <input
                  type="email"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-emerald-500 outline-none transition-all"
                  placeholder="you@example.com"
                  required
                />
              </div>
              <div>
                <label className="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Password</label>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-emerald-500 outline-none transition-all"
                  placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                  required
                />
              </div>

              {error && (
                <div className="p-3 rounded-xl bg-red-50 dark:bg-red-900/30 text-red-600 dark:text-red-400 text-sm">
                  {error}
                </div>
              )}

              <button
                type="submit"
                disabled={loading}
                className="w-full py-3 rounded-xl bg-gradient-to-r from-emerald-500 to-teal-500 text-white font-semibold hover:from-emerald-600 hover:to-teal-600 transition-all disabled:opacity-50"
              >
                {loading ? 'Please wait...' : (isLogin ? 'Sign In' : 'Create Account')}
              </button>
            </form>

            <div className="mt-6 text-center text-sm text-slate-500 dark:text-slate-400">
              {isLogin ? "Don't have an account? " : "Already have an account? "}
              <button 
                onClick={() => setIsLogin(!isLogin)}
                className="text-emerald-600 hover:text-emerald-700 font-medium"
              >
                {isLogin ? 'Sign up' : 'Sign in'}
              </button>
            </div>
          </Card>
        </div>
      </main>
    </div>
  );
}

function MainApp() {
  const { user, signOut, darkMode, setDarkMode, mealPlan, setMealPlan, groceryList, setGroceryList, aiMessages, aiLoading, askAI } = useApp();
  const [tab, setTab] = useState('plan');
  const [aiInput, setAiInput] = useState('');

  const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
  const meals = ['Breakfast', 'Lunch', 'Dinner'];

  const handleAddMeal = (day, meal) => {
    const mealName = prompt(`What's for ${meal.toLowerCase()} on ${day}?`);
    if (mealName) {
      setMealPlan(prev => ({
        ...prev,
        [`${day}-${meal}`]: mealName
      }));
    }
  };

  const handleAISubmit = (e) => {
    e.preventDefault();
    if (aiInput.trim() && !aiLoading) {
      askAI(aiInput);
      setAiInput('');
    }
  };

  const handleSend = (text) => {
    if (!aiLoading) {
      askAI(text);
    }
  };

  const addToGrocery = (item) => {
    if (item && !groceryList.find(i => i.name === item)) {
      setGroceryList([...groceryList, { name: item, checked: false }]);
    }
  };

  const toggleGroceryItem = (index) => {
    setGroceryList(groceryList.map((item, i) => 
      i === index ? { ...item, checked: !item.checked } : item
    ));
  };

  return (
    <div className="min-h-screen pb-20">
      <header className="glass sticky top-0 z-50 border-b border-slate-200 dark:border-slate-700">
        <div className="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
          <div className="flex items-center gap-2">
            <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center">
              <span className="text-lg">üçΩÔ∏è</span>
            </div>
            <span className="text-lg font-bold bg-gradient-to-r from-emerald-600 to-teal-600 bg-clip-text text-transparent">MealMate</span>
          </div>
          <div className="flex items-center gap-3">
            <button
              onClick={() => setDarkMode(!darkMode)}
              className="p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors"
            >
              {darkMode ? '‚òÄÔ∏è' : 'üåô'}
            </button>
            <button
              onClick={signOut}
              className="text-sm text-slate-600 dark:text-slate-400 hover:text-slate-900 dark:hover:text-white"
            >
              Sign Out
            </button>
          </div>
        </div>
      </header>

      <main className="max-w-lg mx-auto px-4 py-6">
        {tab === 'plan' && (
          <div className="space-y-4">
            <h2 className="text-xl font-bold text-slate-900 dark:text-white">Weekly Meal Plan</h2>
            {days.map(day => (
              <Card key={day} className="p-4">
                <h3 className="font-semibold text-slate-900 dark:text-white mb-3">{day}</h3>
                <div className="space-y-2">
                  {meals.map(meal => (
                    <div key={meal} className="flex items-center justify-between">
                      <span className="text-sm text-slate-600 dark:text-slate-400">{meal}</span>
                      {mealPlan[`${day}-${meal}`] ? (
                        <span className="text-sm font-medium text-emerald-600">{mealPlan[`${day}-${meal}`]}</span>
                      ) : (
                        <button
                          onClick={() => handleAddMeal(day, meal)}
                          className="text-xs px-3 py-1 rounded-full bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 hover:bg-emerald-200 transition-colors"
                        >
                          + Add
                        </button>
                      )}
                    </div>
                  ))}
                </div>
              </Card>
            ))}
          </div>
        )}

        {tab === 'ai' && (
          <Card className="h-[calc(100vh-200px)] flex flex-col">
            <h2 className="text-xl font-bold text-slate-900 dark:text-white mb-4">AI Chef</h2>
            <div className="flex-1 overflow-y-auto space-y-4 mb-4">
              {aiMessages.length === 0 ? (
                <div className="h-full flex flex-col items-center justify-center text-center">
                  <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-emerald-400 to-teal-500 flex items-center justify-center mb-4 animate-float">
                    <span className="text-2xl">üë®‚Äçüç≥</span>
                  </div>
                  <h3 className="text-lg font-semibold text-slate-900 dark:text-white mb-2">What should we cook?</h3>
                  <p className="text-slate-500 mb-6 max-w-sm">Ask me for meal ideas, cooking tips, or recipe suggestions!</p>
                  <div className="grid grid-cols-2 gap-2 w-full max-w-sm">
                    {[{i:'ü•ó',t:'Quick dinner ideas'},{i:'üí™',t:'High-protein meals'},{i:'üå±',t:'Vegetarian recipes'},{i:'‚è±Ô∏è',t:'20-minute meals'}].map(p => (
                      <button key={p.t} onClick={() => handleSend(p.t)}
                        className="flex items-center gap-2 p-3 rounded-xl bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors text-left">
                        <span className="text-xl">{p.i}</span>
                        <span className="text-sm text-slate-700 dark:text-slate-300">{p.t}</span>
                      </button>
                    ))}
                  </div>
                </div>
              ) : (
                aiMessages.map((msg, i) => (
                  <div key={i} className={`flex gap-3 ${msg.role === 'user' ? 'flex-row-reverse' : ''}`}>
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${msg.role === 'user' ? 'bg-emerald-500' : 'bg-slate-200 dark:bg-slate-700'}`}>
                      {msg.role === 'user' ? 'üë§' : 'üë®‚Äçüç≥'}
                    </div>
                    <div className={`max-w-[80%] p-3 rounded-2xl ${msg.role === 'user' ? 'bg-emerald-500 text-white' : 'bg-slate-100 dark:bg-slate-700 text-slate-900 dark:text-white'}`}>
                      {msg.content}
                    </div>
                  </div>
                ))
              )}
              {aiLoading && (
                <div className="flex gap-3">
                  <div className="w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center">üë®‚Äçüç≥</div>
                  <div className="bg-slate-100 dark:bg-slate-700 p-3 rounded-2xl">
                    <span className="animate-pulse">Thinking...</span>
                  </div>
                </div>
              )}
            </div>
            <form onSubmit={handleAISubmit} className="flex gap-2">
              <input
                type="text"
                value={aiInput}
                onChange={(e) => setAiInput(e.target.value)}
                placeholder="Ask about recipes, meal ideas..."
                className="flex-1 px-4 py-3 rounded-xl border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-emerald-500 outline-none"
              />
              <button
                type="submit"
                disabled={aiLoading || !aiInput.trim()}
                className="px-4 py-3 rounded-xl bg-emerald-500 text-white hover:bg-emerald-600 disabled:opacity-50 transition-colors"
              >
                Send
              </button>
            </form>
          </Card>
        )}

        {tab === 'grocery' && (
          <Card>
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-bold text-slate-900 dark:text-white">Grocery List</h2>
              <button
                onClick={() => {
                  const item = prompt('Add item:');
                  if (item) addToGrocery(item);
                }}
                className="px-3 py-1 rounded-full bg-emerald-500 text-white text-sm hover:bg-emerald-600 transition-colors"
              >
                + Add Item
              </button>
            </div>
            {groceryList.length === 0 ? (
              <p className="text-center text-slate-500 py-8">Your grocery list is empty. Add items or let AI generate a list!</p>
            ) : (
              <ul className="space-y-2">
                {groceryList.map((item, index) => (
                  <li key={index} className="flex items-center gap-3">
                    <input
                      type="checkbox"
                      checked={item.checked}
                      onChange={() => toggleGroceryItem(index)}
                      className="w-5 h-5 rounded border-slate-300 text-emerald-500 focus:ring-emerald-500"
                    />
                    <span className={`flex-1 ${item.checked ? 'line-through opacity-50' : ''}`}>
                      {item.name}
                    </span>
                  </li>
                ))}
              </ul>
            )}
          </Card>
        )}
      </main>

      <nav className="fixed bottom-0 left-0 right-0 glass border-t border-slate-200 dark:border-slate-700 px-4 py-3">
        <div className="max-w-lg mx-auto flex justify-around">
          {[
            { id: 'plan', icon: 'üìÖ', label: 'Plan' },
            { id: 'ai', icon: 'ü§ñ', label: 'AI Chef' },
            { id: 'grocery', icon: 'üõí', label: 'Grocery' }
          ].map(t => (
            <button
              key={t.id}
              onClick={() => setTab(t.id)}
              className={`flex flex-col items-center gap-1 px-4 py-2 rounded-xl transition-colors ${
                tab === t.id
                  ? 'text-emerald-600 bg-emerald-50 dark:bg-emerald-900/30'
                  : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'
              }`}
            >
              <span className="text-xl">{t.icon}</span>
              <span className="text-xs font-medium">{t.label}</span>
            </button>
          ))}
        </div>
      </nav>
    </div>
  );
}

function App() {
  const { loading, user } = useApp();

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <span className="text-4xl animate-pulse">üçΩÔ∏è</span>
      </div>
    );
  }

  return user ? <MainApp /> : <LandingPage />;
}

ReactDOM.createRoot(document.getElementById('root')).render(
  <AppProvider><App /></AppProvider>
);
</script>
</body>
</html>
