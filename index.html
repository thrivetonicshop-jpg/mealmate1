-- =============================================
-- BEST MEAL MATE V4.0 - SUPABASE SETUP
-- Run this in Supabase SQL Editor
-- =============================================

-- PANTRY TABLE (for fridge tracking with expiration)
CREATE TABLE IF NOT EXISTS pantry (
    id BIGINT PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    name TEXT NOT NULL,
    emoji TEXT DEFAULT 'ðŸ“¦',
    category TEXT DEFAULT 'other',
    quantity TEXT DEFAULT '1',
    expires_in INTEGER DEFAULT 7,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- FAVORITES TABLE (for saved recipes)
CREATE TABLE IF NOT EXISTS favorites (
    id SERIAL PRIMARY KEY,
    user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
    recipe_id INTEGER NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    UNIQUE(user_id, recipe_id)
);

-- Enable Row Level Security
ALTER TABLE pantry ENABLE ROW LEVEL SECURITY;
ALTER TABLE favorites ENABLE ROW LEVEL SECURITY;

-- RLS Policies (users can only access their own data)
CREATE POLICY "Users manage own pantry" ON pantry FOR ALL USING (auth.uid() = user_id);
CREATE POLICY "Users manage own favorites" ON favorites FOR ALL USING (auth.uid() = user_id);

-- =============================================
-- DONE! Your existing tables:
-- meal_plans (JSONB) âœ“
-- grocery_lists (JSONB) âœ“
-- =============================================
